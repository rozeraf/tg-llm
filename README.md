# tg-llm (Multi-User Version)

Продвинутый, многопользовательский телеграм-бот, который выступает в роли персонального AI-ассистента. Каждый пользователь имеет свои собственные, полностью настраиваемые параметры.

## Ключевые возможности

- **Многопользовательская архитектура**: Каждый пользователь имеет свой собственный аккаунт и индивидуальные настройки.
- **Безопасное хранение**: API-ключи пользователей шифруются перед сохранением в базу данных PostgreSQL.
- **Персональные настройки**: Пользователи могут настраивать свои собственные эндпоинты, модели, системные промпты и другие параметры через инлайн-меню.
- **Расширенный контекст**: Поддержка текстовых файлов, PDF-документов и изображений в качестве контекста для запросов.
- **Интеллектуальные режимы**: Автоматический выбор между "быстрой" и "умной" (reasoning) моделью в зависимости от сложности запроса.
- **Веб-поиск**: Возможность поиска актуальной информации в интернете для обогащения ответов.
- **Надежность**: Использование PostgreSQL для хранения данных и Docker Compose для легкого развертывания.

## Настройка и запуск

### 1. Клонирование репозитория

```bash
git clone <repository_url>
cd tg-llm
```

### 2. Настройка переменных окружения

Создайте файл `.env` из примера:

```bash
cp .env.example .env
```

Откройте `.env` и заполните переменные:

- `TELEGRAM_TOKEN`: Ваш токен для Telegram бота.
- `POSTGRES_HOST`, `POSTGRES_PORT`, `POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD`: Параметры подключения к вашей базе данных PostgreSQL.
- `ENCRYPTION_KEY`: **Важно!** Сгенерируйте ключ для шифрования API-ключей пользователей. Выполните в терминале:
  ```bash
  python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
  ```
  Скопируйте полученный ключ в `.env`.

### 3. Запуск с помощью Docker Compose

Убедитесь, что у вас установлен Docker и Docker Compose.

Запустите бота и базу данных:

```bash
docker-compose up --build -d
```

При первом запуске в директории проекта будет создана папка `postgres-data`. **Не удаляйте ее**, так как в ней хранятся все данные пользователей и истории чатов. 

Для просмотра логов бота:

```bash
docker-compose logs -f bot
```

### 4. Начало работы

1.  Найдите вашего бота в Telegram и отправьте команду `/start`.
2.  Бот проведет вас через процесс первоначальной настройки, запросив эндпоинт, модель и ваш API-ключ.
3.  После сохранения этих данных ваш персональный аккаунт будет готов к работе.

### 5. Управление настройками

Используйте команду `/settings`, чтобы в любой момент изменить любую из ваших персональных настроек через удобное инлайн-меню.
