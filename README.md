# tg-llm

Простой телеграмм бот на пайтоне, который просит апи, токен и прочее, а взамен дает простенький чат с ии.

## Возможности

- Проксирование сообщений к LLM API (OpenRouter-совместимому).
- Сохранение полной истории чата в базе данных PostgreSQL.
- Настройка через инлайн-кнопки в Telegram.
- Умное управление контекстом для оптимизации расхода токенов.
- Запуск с помощью Docker Compose для простоты развертывания.

## Настройка и запуск

### 1. Клонирование репозитория

```bash
git clone <repository_url>
cd tg-llm
```

### 2. Настройка переменных окружения

Создайте файл `.env` на основе примера `.env.example`:

```bash
cp .env.example .env
```

Откройте файл `.env` и заполните необходимые значения:

- `TELEGRAM_TOKEN`: Ваш токен для Telegram бота.
- `API_KEY`: Ключ для доступа к LLM API.
- `POSTGRES_HOST`: Хост базы данных (оставьте `db` при запуске через Docker).
- `POSTGRES_PORT`: Порт базы данных (стандартно `5432`).
- `POSTGRES_DB`: Название базы данных.
- `POSTGRES_USER`: Имя пользователя для доступа к базе данных.
- `POSTGRES_PASSWORD`: Пароль для доступа к базе данных.

### 3. Запуск с помощью Docker Compose

Убедитесь, что у вас установлен Docker и Docker Compose.

Запустите бота и базу данных с помощью команды:

```bash
docker-compose up --build -d
```

Бот будет запущен в фоновом режиме. Для просмотра логов используйте команду:

```bash
docker-compose logs -f bot
```

### 4. Первоначальная настройка бота

1.  Откройте чат с вашим ботом в Telegram.
2.  Отправьте команду `/start`.
3.  Бот попросит вас указать URL эндпоинта, модель и API ключ (если он еще не указан в `.env`).
4.  После завершения настройки бот готов к работе.

### 5. Настройки

Используйте команду `/settings` для изменения параметров бота через инлайн-меню:
- **API Key**: Изменить API ключ.
- **System prompt**: Изменить системный промпт.
- **Endpoint**: Изменить URL API.
- **Model**: Изменить используемую модель.
- **Context messages**: Настроить количество последних сообщений, включаемых в контекст при каждом запросе.